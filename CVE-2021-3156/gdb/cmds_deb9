set breakpoint pending on
set disassembly-flavor intel
set print pretty on
set print asm-demangle on
# disable paging
set height 0
set width 0
set pagination off
set $outside = 1
# open file. on old system might be open syscall
catch syscall openat
commands
  set $outside = ! $outside
  if ($outside)
    i r $rax
  else
    bt 4
  end
  continue
end
# malloc
break __libc_malloc
commands
  bt
  continue
end
# malloc result from _int_malloc
break malloc.c:2931
commands
  i r $rax
  continue
end
# free
break __libc_free
commands
  bt
  if $rdi != 0
    x/4s $rdi
  end
  continue
end
# realloc(NULL, size) called malloc directly
break __libc_realloc if $rdi != 0
commands
  bt
  #x/4s $rdi
  continue
end
# realloc result, from _int_realloc
break *(__libc_realloc+345)
commands
  i r $rax
  continue
end
# nss_load_library
break nss_load_library
commands
  continue
end
# calloc
break __libc_calloc
commands
  bt
  continue
end
# calloc result, return from _int_malloc()
break *(__libc_calloc+635)
commands
  i r $rax
  continue
end
#run
continue
bt
info proc mappings
quit

